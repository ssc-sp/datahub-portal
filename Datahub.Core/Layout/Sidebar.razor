@using Datahub.Core.Data
@using Datahub.Core.Utils
@using Datahub.Portal.Services
@inject ServiceAuthManager ServiceAuthManager


<MudNavMenu Bordered Color="Color.Primary">
    @foreach (var (href, icon, label) in GetLinks())
    {
        <MudNavLink Href="@href" Icon="@icon.Name" Match="NavLinkMatch.Prefix">
            @Localizer[label]
        </MudNavLink>
    }
    @foreach (var (href, icon, label, roles) in GetAuthorizedLinks())
    {
        <AuthorizeView Roles="@string.Join(',', roles)">
            <MudNavLink Href="@href" Icon="@icon.Name" Match="NavLinkMatch.Prefix">
                @Localizer[label]
            </MudNavLink>
        </AuthorizeView>
    }
</MudNavMenu>

@code {


    private List<(string Href, Icon Icon, string Label)> GetLinks()
    {
        return new List<(string, Icon, string)>()
        {
            ("/home", Icon.HOME, "SIDEBAR.Home"),
    //("/data", Icon.STORAGE, "SIDEBAR.Storage"),
            ($"/{UrlPathSegment.PROJECTS}", Icon.PROJECT, "SIDEBAR.DataProjects"),
            ("/resources", Icon.RESOURCES, "SIDEBAR.Resources"),
            ("/tools", Icon.TOOLS, "SIDEBAR.Tools"),
    //("/datasets", Icon.DATASETS, "SIDEBAR.Datasets"),
    //("/powerbi", Icon.POWERBI, "SIDEBAR.PowerBI"),      
        };
    }

    private List<(string Href, Icon Icon, string Label, List<string> Roles)> GetAuthorizedLinks()
    {
        var projects = ServiceAuthManager.GetAdminProjectRoles();
        if (projects.Any())
        {
            return new List<(string, Icon, string, List<string>)>()
            {
                ("/administration", Icon.ADMIN, "SIDEBAR.Admin", projects),
            };
        }

        return new List<(string, Icon, string, List<string>)>();
    }

}