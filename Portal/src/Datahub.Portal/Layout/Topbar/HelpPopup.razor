@using MudBlazor.Utilities
@inject IConfiguration Configuration


<span>
    <MudTooltip Text="@Localizer[TOOLTIP_TEXT]">
        <MudToggleIconButton
            aria-label="Help toggle"
            ToggledIcon="@Icons.Material.Filled.Help"
            ToggledChanged="@ToggleHelp"
            Toggled="_showHelp"
            Icon="@Icons.Material.Outlined.HelpOutline"/>
        </MudTooltip>

    <MudPopover
        Style="@_style"
        Open="@_showHelp"
        AnchorOrigin="Origin.BottomRight"
        TransformOrigin="Origin.TopRight">
        <MudCard Elevation="0" Class="py-4 px-6">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h2">@Localizer["Troubleshooting"]</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    @*Tooltip currently does not work here*@
                    @*issue has been reported here: https://github.com/MudBlazor/MudBlazor/issues/5542*@
                    <MudTooltip Text="@(Localizer["Close"])">
                        <MudIconButton Icon="@Icons.Material.Filled.Close" Color="Color.Default" OnClick="ToggleHelp"/>
                    </MudTooltip>
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                <MudStack>
                    <MudText>@Localizer["Need a hand? We've got you covered."]</MudText>
                    <MudText Typo="Typo.body2">@Localizer["Our Resources page has many resources that could be helpful for you. Additional support is available using the FSDH Support Request Form."]</MudText>
                    <MudLink Href="/resources" OnClick="ToggleHelp">Resources</MudLink>
                </MudStack>
                <HelpDialog ToggleHelp="@ToggleHelp" />
            </MudCardContent>
        </MudCard>
    </MudPopover>
</span>

@code {
    [Parameter]
    public string SupportFormUrl { get; set; }
    private string _style;
    private bool _showHelp;
    private string _datahubEmail;
    private const string TOOLTIP_TEXT = "Help";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        _datahubEmail = Configuration.GetValue<string>("EmailNotification:DatahubEmail") ?? "datahub@nrcan-rncan.gc.ca";

        _style = new StyleBuilder()
            .AddStyle("width", "550px")
            .Build();
    }

    private void ToggleHelp()
    {
        _showHelp = !_showHelp;
    }

}