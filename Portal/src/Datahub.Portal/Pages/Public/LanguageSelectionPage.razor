@page "/language-langue"
@layout BarebonesPublicLayout

@inject NavigationManager _navManager
@inject ICultureService CultureService


<PageTitle>Federal Science DataHub / DataHub scientifique fédéral</PageTitle>


<MudContainer MaxWidth=@MaxWidth.ExtraSmall >
    <MudStack>
        <MudSpacer />
        <MudPaper Class="pa-10 mt-20" >
            <MudStack>
                <MudImage Src="/img/canada-fip.svg" Alt="Government of Canada Wordmark / Symbole de mot du gouvernement du Canada" Style="max-height: 2rem" />
                <MudSpacer />
                <MudStack Row>
                    <MudButton Variant=@Variant.Filled Color=@Color.Primary OnClick=@(() => SetLanguage(CultureService.CanadaEnglish))>English</MudButton>
                    <MudButton Variant=@Variant.Filled Color=@Color.Primary OnClick=@(() => SetLanguage(CultureService.CanadaFrench))>Français</MudButton>
                </MudStack>
                <MudSpacer />
                <MudStack Row>
                    <MudLink Href=@EnglishTermsUrl Target="_blank" Typo="Typo.body1">
                        Terms and conditions
                    </MudLink>
                    <MudDivider Vertical />
                    <MudLink Href=@FrenchTermsUrl Target="_blank" Typo="Typo.body1">
                        Avis
                    </MudLink>
                    <MudSpacer />
                    <MudImage Src="/img/fip_mark.png" Alt="Canada" Style="max-height: 1rem" />
                </MudStack>
            </MudStack>
        </MudPaper>
    </MudStack>
</MudContainer>

@code {

    [SupplyParameterFromQuery(Name = "redirectUrl")]
    public string RedirectUrl { get; set; }

    private string EnglishTermsUrl => $"{PageRoutes.TermsAndConditions}?culture={CultureService.CanadaEnglish}";
    private string FrenchTermsUrl => $"{PageRoutes.TermsAndConditions_FR}?culture={CultureService.CanadaFrench}";

    private async Task SetLanguage(string language)
    {
        await CultureService.SetLanguageInLocalStorageAsync(language);

        if (string.IsNullOrWhiteSpace(RedirectUrl))
        {
            RedirectUrl = "/";
        }

        var query = $"?culture={Uri.EscapeDataString(language)}" +
                    $"&redirectionUri={Uri.EscapeDataString(RedirectUrl)}";
        _navManager.NavigateTo($"/Culture/SetCulture{query}", forceLoad: true);
    }
}
