@using System.Text.RegularExpressions
@using MudBlazor.Utilities
@inject NavigationManager NavigationManager


<MudStack>
    <MudText Typo="Typo.h6" Style="text-transform: uppercase;">@Localizer["On This Page"]</MudText>
    <MudDivider Class="my-2" />
    @foreach (var heading in Headings)
    {
        <MudLink Href="@GetLink(heading)">
            <MudText Typo="Typo.body2">
                @heading
            </MudText>
        </MudLink>
    }
</MudStack>

@code {

    [Parameter]
    public List<string> Headings { get; set; }

    //Comes from MudMarkdown library. Unfortunately, it's not public.
    private static readonly string[] EscapeChars = { "+", ":", "&" };

    private string GetLink(string heading)
    {
        var headingId = string.Join("-", heading.Split(EscapeChars, StringSplitOptions.None)
            .Select(word => word.TrimStart().ToLowerInvariant()))
            .Replace(" ", "-");
    // remove the current heading from the url
        var hashIndex = NavigationManager.Uri.IndexOf('#');
        var url = hashIndex >= 0 ? NavigationManager.Uri[..hashIndex] : NavigationManager.Uri;
        return $"{url}#{headingId}";
    }

}