@* AzureConnectionDataInput.razor *@

<MudTextField @bind-Value="AccountName"
              Label=@Localizer["Storage Account Name"]
              Variant="Variant.Text"
              Adornment=@Adornment.End
              AdornmentIcon=@Icons.Material.Filled.ContentPaste />

<MudTextField @bind-Value="AccountKey"
              Label=@Localizer["Account Key"]
              Variant="Variant.Text"
              InputType="InputType.Password"
              Adornment=@Adornment.End
              AdornmentIcon=@Icons.Material.Filled.ContentPaste />



@code {
    
    [Parameter]
    public string ConnectionData { get; set; }

    [Parameter]
    public EventCallback<string> ConnectionDataChanged { get; set; }

    [Parameter]
    public EventCallback<bool> OnValidationChanged { get; set; }

    private AzureConnectionData _azConnectionData = new();

    private bool IsValid => !(string.IsNullOrEmpty(AccountName) || string.IsNullOrEmpty(AccountKey));

    private string AccountName
    {
        get => _azConnectionData.AccountName;
        set
        {
            _azConnectionData.AccountName = value;
            Validate();
        }
    }

    private string AccountKey
    {
        get => _azConnectionData.AccountKey;
        set
        {
            _azConnectionData.AccountKey = value;
            Validate();
        }
    }

    private void Validate()
    {
        if (OnValidationChanged.HasDelegate)
        {
            OnValidationChanged.InvokeAsync(IsValid);
        }

        if (ConnectionDataChanged.HasDelegate)
        {
            ConnectionDataChanged.InvokeAsync(_azConnectionData.ConnectionData);
        }
    }

    protected override void OnInitialized()
    {
        var azData = CloudStorageConnectionDataDecoder.DecodeAzure(ConnectionData);
        if (azData is not null)
        {
            _azConnectionData = azData;
        }

        Validate();

        base.OnInitialized();
    }

}
