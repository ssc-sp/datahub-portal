@using Datahub.Core.Services.Storage

@inject CultureService _cultureService
@inject IConfiguration _configuration

<MudStack>
    <SASTokenButton OnSubstitutionsChanged="HandleSubstitutionsChanged" ContainerToken />
    <EmbeddedWiki PageNameEn="/UserGuide/Databricks/Access-your-storage-account-in-Databricks.md"
                  PageNameFr="/fr/UserGuide/Databricks/Accédez-à-votre-compte-de-stockage-dans-Databricks.md"
                  Substitutions="_substitutions" />
</MudStack>


@code {

    [CascadingParameter(Name = "ProjectAcronym")]
    public string ProjectAcronym { get; set; }

    private List<(string, string)> _substitutions;

    private void HandleSubstitutionsChanged(List<(string, string)> substitutions)
    {
        _substitutions = substitutions;
        _substitutions.Add((ResourceSubstitutions.ProjectAcronym, ProjectAcronym));
        _substitutions.Add((ResourceSubstitutions.StorageAccount, ResourceSubstitutions.GetStorageAccountNameFromProjectAcronym(ProjectAcronym)));
        _substitutions.Add((ResourceSubstitutions.ContainerName, DataRetrievalService.DEFAULT_CONTAINER_NAME));
    }
    
    private string GetPageName()
    {
        return _configuration[$"WikiPageTitles:DatabricksStorageAccess:{_cultureService.Culture}"];
    }
}