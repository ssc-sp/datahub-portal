@using Datahub.Core.Model.Projects
@using Datahub.Metadata.DTO
@using Datahub.Portal.Pages.Workspace
@using Datahub.Portal.Pages.Workspace.Subpages
@using Datahub.Portal.Pages.Workspace.Subpages.Dashboard

@inject IDbContextFactory<DatahubProjectDBContext> _dbFactoryProject
@inject IMetadataBrokerService _metadataBrokerService
@inject ILogger<WorkspacePage> _logger

@page "/w/{ProjectAcronymParam}/{Section?}"


<SectionContent SectionName="side-bar">
    <WorkspaceSidebar WorkspaceAcronym="@ProjectAcronymParam"/>
</SectionContent>

<MudContainer MaxWidth="MaxWidth.Large">
    <MudGrid>
        <MudItem xs="12" sm="8">
            <WorkspaceInfo WorkspaceAcronym="@ProjectAcronymParam"/>
        </MudItem>
        <MudItem xs="12" sm="4">
            <WorkspaceAdminInfo WorkspaceAcronym="@ProjectAcronymParam"/>
        </MudItem>
        <MudItem xs="12">
            @{
                var containsKey = _sectionComponents.ContainsKey(Section);
                var parameters = new Dictionary<string, object>
                {
                    { "WorkspaceAcronym", ProjectAcronymParam }
                };
                
                if (containsKey)
                {
                    <DynamicComponent Type="@_sectionComponents[Section]" Parameters="@parameters"/>
                }
                else
                {
                    _logger.LogWarning("The section {Section} is not a valid section for the workspace page", Section);
                    <WorkspaceDashboard WorkspaceAcronym="@ProjectAcronymParam"/>
                }
            }
        </MudItem>
    </MudGrid>
</MudContainer>


@code {

    [Parameter]
    public string ProjectAcronymParam { get; set; }

    [Parameter]
    public string Section { get; set; } = WorkspaceSidebar.SectionViews.Dashboard;

    private Dictionary<string, Type> _sectionComponents = new()
    {
        { WorkspaceSidebar.SectionViews.Users, typeof(WorkspaceUsers) },
        { WorkspaceSidebar.SectionViews.Metadata, typeof(WorkspaceMetadata) },
        { WorkspaceSidebar.SectionViews.Marketplace, typeof(WorkspaceMarketplace) },
        { WorkspaceSidebar.SectionViews.Reports, typeof(WorkspaceReports) },
        { WorkspaceSidebar.SectionViews.Settings, typeof(WorkspaceSettings) },
        { WorkspaceSidebar.SectionViews.Dashboard, typeof(WorkspaceDashboard) }
    };
}