@using Datahub.Application.Services.UserManagement
@inject IMSGraphService MSGraphService

<div class="versionContainer">
    @foreach (var version in Versions)
    {
        <div class="fileGrid" @onclick="() => SelectRowById(version.Versionid)">
            <div class="grid-item">
                <i class="@iconClass(version)"></i>
            </div>
            <div class="grid-item">
                <b>@Localizer["VERSION-LIST-PAGE.Version", version.Index]&nbsp;</b> @version.Index == Versions.Count ? Localizer["VERSION-LIST-PAGE.Current"] : string.Empty
            </div>
            <div class="grid-item">
                <a>not in use</a>
            </div>
            <div class="grid-item">
                @version.Metadata.Uploadeddate.ToString("f", CultureInfo.CreateSpecificCulture("en-CA"))
            </div>
            <div class="grid-item">
                @DatahubTools.BytesToString(version.Metadata.Filesize.ToString())
            </div>
        </div>
    }

</div>

@code {

    [Parameter]
    public List<Datahub.Core.Data.Version> Versions { get; set; }
    [Parameter]
    public EventCallback<string> SelectedItem { get; set; }

    string _selectedItem;

    public string iconClass(Datahub.Core.Data.Version item)
    {
        if (_selectedItem == item.Versionid)
        {
            return "far fa-check-circle icon-color";
        }

        return "fal fa-circle icon-color";
    }

    private Task SelectRowById(string versionid)
    {
        _selectedItem = versionid;
        return SelectedItem.InvokeAsync(versionid);
    }

    private async Task<string> GetStatus(Datahub.Core.Data.Version version)
    {
        string createdUser = await MSGraphService.GetUserName(version.Metadata.Createdby, CancellationToken.None); 
        if (string.IsNullOrWhiteSpace(createdUser))
        {
            createdUser = Localizer["VERSION-LIST-PAGE.Unknown"];
        }

        return Localizer[ version.Index == 1 ? "VERSION-LIST-PAGE.CreatedBy" : "VERSION-LIST-PAGE.EditedBy", createdUser];
    }
}