@namespace NRCan.Datahub.Portal.Components
@inject IUserInformationService UserInformationService
@inject UserLocationManagerService UserLocationManagerService 

<AeFlex class="landing-content-wrapper">
  <AeFlex class="landing-content">
<AeCard>
    <ChildContent>
    <TabControl>
        @foreach(var tab in GetTabs()){
            <TabPage>
              <Control>
                  <AeTypography>@tab.Control</AeTypography>
              </Control>
              <ChildContent>
                @tab.Content
              </ChildContent>
            </TabPage>  
        }
    </TabControl>
</ChildContent>
</AeCard>
  </AeFlex>
</AeFlex>

@code {
    List<UserRecentLink> links = null;

    protected override async Task OnInitializedAsync()
    {
        var currentUser = await UserInformationService.GetUserAsync();
        links = (await UserLocationManagerService.ReadRecentNavigations(currentUser.Id))?.UserRecentActions?.ToList()?? new ();
        links = links.GroupBy(l => (l.LinkType, l.DataProject))
                    .Select(e => e.OrderByDescending(k => k.accessedTime)
                    .FirstOrDefault()).ToList();
    }


    private List<(string Control, RenderFragment Content)> GetTabs()
    {
        var res = new List<(string, RenderFragment)> 
        {        
            //("My Projects", @<AeTypography>My Projects frag</AeTypography>),
            //("Shared with Me", @<AeTypography>Shared with Me frag</AeTypography>),
            ("My Projects", @<NRCan.Datahub.Portal.Components.Landing.Tabs.ProjectsTab />),
            ("My Databricks Workbooks", @<NRCan.Datahub.Portal.Components.Landing.Tabs.DatabricksTab />),
            ("My PowerBI Reports", @<NRCan.Datahub.Portal.Components.Landing.Tabs.DatabricksTab /> ),
        
        };
        if (links?.Count > 0)
        {
            res.Insert(0, ("Recent", @<NRCan.Datahub.Portal.Components.Landing.Tabs.RecentTab RecentLinks="links"/> ));
        }
        return res;
    }

}
