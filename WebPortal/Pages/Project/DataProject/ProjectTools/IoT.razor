@inject IDbContextFactory<DatahubProjectDBContext> _dbFactoryProject
@inject RequestManagementService _requestManagementService

@if (_project is null)
{
    <ToolCard Loading/>
}
else
{
    <ToolCard
        Title="@Localizer["IoT Devices"]"
        Description="@Localizer["Access the connection details for the IoT devices connected to this project"]">
        <Logo>
            <i class="fas fa-router fa-2x"></i>
        </Logo>
        <ToolActionsList>
            <MudStack Row>
                <DHLink LinkType="DatahubLinkType.Storage">
                    <MudButton Color="Color.Primary">@Localizer["Manage Devices"]</MudButton>
                </DHLink>
                <DHLink LinkType="DatahubLinkType.Storage">
                    <MudButton Color="Color.Primary">@Localizer["Connect New Device"]</MudButton>
                </DHLink>
            </MudStack>
        </ToolActionsList>
    </ToolCard>
}

@code {

    private Datahub_Project _project;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        await using var projectDbContext = await _dbFactoryProject.CreateDbContextAsync();

        _project = await projectDbContext.Projects
            .Include(p => p.Requests)
            .FirstAsync();
    }
}